<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayesian Inference: Coin Spinning</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for plotting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- KaTeX for rendering mathematical formulas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOV3LQjfzLzJAZvGnAseemiXTJhA73hc9qsByp7KWYNsztBavUdW" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlV1e1YOFcoCmbcaHLtxNaBQrqsoJmTb4tXllMcfCo3RgZaXYwebkitEVgL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .katex { font-size: 1.1em; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">

        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-cyan-400">Bayesian Inference Explorer</h1>
            <p class="text-lg text-gray-400 mt-2">Updating Beliefs About a Spun Coin</p>
        </header>

        <!-- Part 1: Original Problem and Solution -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl mb-12">
            <h2 class="text-3xl font-semibold mb-4 border-b-2 border-cyan-500 pb-2">Problem Statement</h2>
            <p class="text-gray-300 leading-relaxed">
                Suppose you have a $\text{Beta}(4,4)$ prior distribution on the probability $\theta$ that a coin will yield a ‘head’ when spun. The coin is independently spun ten times, and ‘heads’ appear fewer than 3 times. You are not told exactly how many heads were seen, only that the number is less than 3. Calculate your exact posterior density for $\theta$ and sketch it.
            </p>
        </div>

        <div class="bg-gray-800 p-6 rounded-lg shadow-xl mb-12">
            <h2 class="text-3xl font-semibold mb-4 border-b-2 border-cyan-500 pb-2">Step-by-Step Solution</h2>
            
            <div class="space-y-6">
                <div>
                    <h3 class="text-xl font-semibold text-cyan-400">1. The Prior Distribution</h3>
                    <p>Our prior belief about $\theta$ is given by a Beta distribution, $\text{Beta}(4,4)$. The probability density function (PDF) is proportional to:
                    $$ p(\theta) \propto \theta^{\alpha-1}(1-\theta)^{\beta-1} = \theta^{4-1}(1-\theta)^{4-1} = \theta^3(1-\theta)^3 $$
                    This distribution is symmetric around $\theta=0.5$, indicating we initially believe the coin is fair.
                    </p>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-cyan-400">2. The Likelihood Function</h3>
                    <p>The number of heads, $y$, in $n=10$ spins follows a Binomial distribution. The data we observed is $y < 3$, which means $y$ could be 0, 1, or 2. The likelihood is the probability of this data given $\theta$:
                    $$ P(\text{data}|\theta) = P(y=0|\theta) + P(y=1|\theta) + P(y=2|\theta) $$
                    $$ P(\text{data}|\theta) = \binom{10}{0}\theta^0(1-\theta)^{10} + \binom{10}{1}\theta^1(1-\theta)^9 + \binom{10}{2}\theta^2(1-\theta)^8 $$
                    After simplifying, this gives:
                    $$ P(\text{data}|\theta) \propto (1-\theta)^8(1 + 8\theta + 36\theta^2) $$
                    </p>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-cyan-400">3. The Posterior Distribution</h3>
                    <p>Using Bayes' theorem, the posterior is proportional to the prior times the likelihood:
                    $$ p(\theta|\text{data}) \propto p(\text{data}|\theta) \times p(\theta) $$
                    $$ p(\theta|\text{data}) \propto \left[ (1-\theta)^8(1 + 8\theta + 36\theta^2) \right] \times \left[ \theta^3(1-\theta)^3 \right] $$
                    Combining terms, we get the final posterior density:
                    $$ p(\theta|\text{data}) \propto \theta^3(1-\theta)^{11}(1 + 8\theta + 36\theta^2) $$
                    </p>
                </div>
            </div>

            <div class="mt-8">
                <canvas id="solutionChart"></canvas>
            </div>
        </div>

        <!-- Part 2: Interactive Tool -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl">
            <h2 class="text-3xl font-semibold mb-4 border-b-2 border-cyan-500 pb-2">Interactive Tool</h2>
            <p class="mb-4 text-gray-300">What if we knew the <span class="font-bold text-cyan-400">exact</span> number of heads? When we observe exactly $y$ heads in $n=10$ spins, the Beta-Binomial conjugate pair relationship simplifies things. The posterior becomes another Beta distribution:
            $$ \text{Posterior} = \text{Beta}(\alpha + y, \beta + n - y) = \text{Beta}(4+y, 4+10-y) = \text{Beta}(4+y, 14-y) $$
            Use the slider below to see how the posterior distribution shifts as the number of observed heads changes.
            </p>

            <div class="my-6">
                <label for="headsSlider" class="block mb-2 font-medium">Number of Heads (y): <span id="headsValue" class="font-bold text-cyan-400 text-lg">3</span></label>
                <input type="range" id="headsSlider" min="0" max="10" value="3" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
            </div>

            <div class="mt-8">
                <canvas id="interactiveChart"></canvas>
            </div>
        </div>
        
    </div>

    <script>
        // === Helper Functions ===
        // Unnormalized Beta PDF for plotting shape
        const unnormalizedBetaPDF = (x, alpha, beta) => {
            if (x < 0 || x > 1) return 0;
            return Math.pow(x, alpha - 1) * Math.pow(1 - x, beta - 1);
        };

        // Unnormalized posterior for the original problem (y < 3)
        const unnormalizedPosteriorY_lt_3 = (theta) => {
            if (theta < 0 || theta > 1) return 0;
            return Math.pow(theta, 3) * Math.pow(1 - theta, 11) * (1 + 8 * theta + 36 * Math.pow(theta, 2));
        };
        
        // Function to generate plot data points
        const generatePlotData = (pdfFunc, ...args) => {
            const data = [];
            for (let i = 0; i <= 100; i++) {
                const x = i / 100;
                data.push({ x: x, y: pdfFunc(x, ...args) });
            }
            // Normalize data for better plotting
            const maxY = Math.max(...data.map(p => p.y));
            if (maxY > 0) {
                 return data.map(p => ({ x: p.x, y: p.y / maxY }));
            }
            return data;
        };

        // === Chart 1: Solution for y < 3 ===
        const ctx1 = document.getElementById('solutionChart').getContext('2d');
        const priorData1 = generatePlotData(unnormalizedBetaPDF, 4, 4);
        const posteriorData1 = generatePlotData(unnormalizedPosteriorY_lt_3);

        const solutionChart = new Chart(ctx1, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'Prior: Beta(4, 4)',
                        data: priorData1,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1
                    },
                    {
                        label: 'Posterior: For y < 3',
                        data: posteriorData1,
                        borderColor: 'rgb(22, 163, 74)',
                        backgroundColor: 'rgba(22, 163, 74, 0.5)',
                        borderWidth: 3,
                        pointRadius: 0,
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                parsing: {
                    xAxisKey: 'x',
                    yAxisKey: 'y'
                },
                scales: {
                    x: {
                        type: 'linear',
                        title: {
                            display: true,
                            text: 'θ (Probability of Heads)',
                            color: '#d1d5db'
                        },
                        ticks: { color: '#9ca3af' },
                        grid: { color: 'rgba(156, 163, 175, 0.2)' }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Relative Density',
                            color: '#d1d5db'
                        },
                        ticks: { color: '#9ca3af' },
                        grid: { color: 'rgba(156, 163, 175, 0.2)' }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#d1d5db'
                        }
                    }
                }
            }
        });
        
        // === Chart 2: Interactive Tool ===
        const ctx2 = document.getElementById('interactiveChart').getContext('2d');
        const slider = document.getElementById('headsSlider');
        const headsValue = document.getElementById('headsValue');

        const priorData2 = generatePlotData(unnormalizedBetaPDF, 4, 4);
        
        const interactiveChart = new Chart(ctx2, {
            type: 'line',
            data: {
                datasets: [
                     {
                        label: 'Prior: Beta(4, 4)',
                        data: priorData2,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1
                    },
                    {
                        label: 'Posterior: Beta(7, 11)', // Initial state
                        data: [], // Initially empty
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderWidth: 3,
                        pointRadius: 0,
                        tension: 0.1
                    }
                ]
            },
            options: {
                 responsive: true,
                parsing: {
                    xAxisKey: 'x',
                    yAxisKey: 'y'
                },
                scales: {
                    x: {
                        type: 'linear',
                        title: {
                            display: true,
                            text: 'θ (Probability of Heads)',
                            color: '#d1d5db'
                        },
                        ticks: { color: '#9ca3af' },
                        grid: { color: 'rgba(156, 163, 175, 0.2)' }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Relative Density',
                            color: '#d1d5db'
                        },
                         ticks: { color: '#9ca3af' },
                         grid: { color: 'rgba(156, 163, 175, 0.2)' }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#d1d5db'
                        }
                    }
                }
            }
        });

        const updateChart = () => {
            const y = parseInt(slider.value);
            headsValue.textContent = y;

            const alpha_post = 4 + y;
            const beta_post = 14 - y;
            
            const posteriorData = generatePlotData(unnormalizedBetaPDF, alpha_post, beta_post);
            interactiveChart.data.datasets[1].data = posteriorData;
            interactiveChart.data.datasets[1].label = `Posterior: Beta(${alpha_post}, ${beta_post})`;
            interactiveChart.update();
        };

        slider.addEventListener('input', updateChart);
        
        // Initial render for the interactive chart
        document.addEventListener('DOMContentLoaded', () => {
             renderMathInElement(document.body);
             updateChart();
        });
    </script>
</body>
</html>