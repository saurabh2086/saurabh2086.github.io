<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solution: Beta-Binomial Updating (Q9)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- MathJax Configuration: Enable $ for inline math -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        .math-card {
            background-color: #ffffff;
            border-left: 4px solid #4f46e5;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .logic-note {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            color: #1e3a8a;
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #2c3e50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .home-button:hover {
            background: #34495e;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 font-sans">
    <a href="../../index.html" class="home-button">
        <i class="fas fa-home"></i> ←Home
    </a>

    <!-- Header -->
    <header class="bg-slate-900 text-white p-6 shadow-md">
        <div class="max-w-5xl mx-auto">
            <h1 class="text-3xl font-bold text-indigo-400">Bayesian Solution: Question 9</h1>
            <p class="text-slate-400 mt-2">Setting Parameters for a Beta Prior & Sensitivity Analysis</p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-6 space-y-8 mt-6">

        <!-- 1. Original Question -->
        <section>
            <h2 class="text-2xl font-bold text-slate-800 mb-4 border-b pb-2">1. Original Question</h2>
            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                <p class="leading-relaxed mb-4">
                    <strong>Setting parameters for a beta prior distribution:</strong> suppose your prior distribution
                    for $\theta$, the proportion of Californians who support the death penalty, is beta with mean
                    <strong>0.6</strong> and standard deviation <strong>0.3</strong>.
                </p>
                <ul class="list-disc pl-5 space-y-2 text-slate-700">
                    <li><strong>(a)</strong> Determine the parameters $\alpha$ and $\beta$ of your prior distribution.
                        Sketch the prior density function.</li>
                    <li><strong>(b)</strong> A random sample of <strong>1000</strong> Californians is taken, and
                        <strong>65%</strong> support the death penalty. What are your posterior mean and variance for
                        $\theta$? Draw the posterior density function.
                    </li>
                    <li><strong>(c)</strong> Examine the sensitivity of the posterior distribution to different prior
                        means and widths including a non-informative prior.</li>
                </ul>
            </div>
        </section>

        <!-- 2. Part A Solution -->
        <section>
            <h2 class="text-2xl font-bold text-slate-800 mb-4">2. Part (a): Finding Parameters</h2>
            <div class="math-card">
                <h3 class="font-bold text-indigo-700 mb-2">The Logic (Method of Moments)</h3>
                <p class="text-sm text-slate-600 mb-3">
                    The Beta distribution is defined by shape parameters $\alpha$ and $\beta$, but we are given
                    "human-readable" stats: Mean ($\mu$) and Std Dev ($\sigma$). We must reverse-engineer the formulas:
                </p>
                <div class="overflow-x-auto">
                    $$ \mu = \frac{\alpha}{\alpha + \beta} \quad \text{and} \quad \sigma^2 = \frac{\mu(1-\mu)}{\alpha +
                    \beta + 1} $$
                </div>
                <div class="logic-note">
                    <strong>Step-by-Step:</strong><br>
                    1. Calculate variance $\sigma^2 = 0.3^2 = 0.09$.<br>
                    2. Solve the variance equation for the "sample size equivalent" quantity $\nu = \alpha + \beta$.<br>
                    3. Use $\mu$ to split $\nu$ into $\alpha$ and $\beta$.
                </div>
                <div class="mt-4 p-4 bg-slate-100 rounded font-mono text-sm text-slate-700">
                    <strong>Calculated Values:</strong><br>
                    <span id="text-alpha-prior">α ≈ 1.00</span><br>
                    <span id="text-beta-prior">β ≈ 0.67</span>
                </div>
            </div>
        </section>

        <!-- 3. Part B Solution -->
        <section>
            <h2 class="text-2xl font-bold text-slate-800 mb-4">3. Part (b): Posterior Update</h2>
            <div class="math-card border-l-emerald-500">
                <h3 class="font-bold text-emerald-700 mb-2">The Logic (Conjugacy)</h3>
                <p class="text-sm text-slate-600 mb-3">
                    Because we used a <strong>Beta</strong> prior and <strong>Binomial</strong> data, we don't need
                    complex integrals. We simply add the data counts to the prior parameters.
                    <br><br>
                    Think of $\alpha$ as "prior successes" and $\beta$ as "prior failures".
                </p>
                <div class="overflow-x-auto">
                    $$ \alpha_{post} = \alpha_{prior} + y \quad (\text{successes}) $$
                    $$ \beta_{post} = \beta_{prior} + (n - y) \quad (\text{failures}) $$
                </div>
                <div class="logic-note border-emerald-200 bg-emerald-50 text-emerald-900">
                    <strong>Data:</strong> n=1000, 65% support implies y=650 successes.<br>
                    <strong>Update:</strong> Add 650 to $\alpha$ and 350 to $\beta$.
                </div>
                <div class="mt-4 p-4 bg-slate-100 rounded font-mono text-sm text-slate-700">
                    <strong>Posterior Results:</strong><br>
                    <span id="text-alpha-post">α_post = 651.00</span><br>
                    <span id="text-beta-post">β_post = 350.67</span><br>
                    <span id="text-mean-post">Mean ≈ 0.650</span>
                </div>
            </div>
        </section>

        <!-- 4. Part C Solution -->
        <section>
            <h2 class="text-2xl font-bold text-slate-800 mb-4">4. Part (c): Sensitivity Analysis</h2>
            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 mb-8">
                <p class="mb-4 text-slate-700">
                    <strong>Concept:</strong> Sensitivity analysis asks, "Does my answer change significantly if I
                    change my prior assumptions?"
                </p>
                <p class="mb-4 text-slate-700">
                    With a sample size of <strong>n = 1000</strong>, the data is overwhelming. Even if we change the
                    prior from our informative one (Mean 0.6) to a non-informative one (Mean 0.5, very wide), the
                    posterior will hardly budge.
                </p>
                <p class="font-bold text-indigo-600">
                    Use the interactive tool below to test this yourself. Try changing the "Prior Mean" slider and watch
                    how little the "Posterior" (Green) curve moves!
                </p>
            </div>
        </section>

        <!-- Interactive Solver Section (Relocated) -->
        <section class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
            <h3 class="font-bold text-slate-800 mb-6 text-center text-xl">Interactive Solver</h3>

            <!-- Controls Grid (Side by Side) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

                <!-- Prior Controls -->
                <div class="bg-indigo-50 p-5 rounded-lg border border-indigo-100 h-full">
                    <h4
                        class="text-xs font-bold text-indigo-900 uppercase tracking-wide mb-4 border-b border-indigo-200 pb-2">
                        Prior Beliefs (Part A & C)</h4>

                    <div class="mb-6">
                        <label class="flex justify-between text-sm font-medium text-slate-600 mb-2">
                            <span>Prior Mean ($\mu_0$)</span>
                            <span id="val-mu" class="font-mono text-indigo-600 font-bold">0.6</span>
                        </label>
                        <input type="range" id="input-mu" min="0.1" max="0.9" step="0.01" value="0.6"
                            class="w-full h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                    </div>

                    <div>
                        <label class="flex justify-between text-sm font-medium text-slate-600 mb-2">
                            <span>Prior Std Dev ($\sigma_0$)</span>
                            <span id="val-sigma" class="font-mono text-indigo-600 font-bold">0.3</span>
                        </label>
                        <input type="range" id="input-sigma" min="0.05" max="0.45" step="0.01" value="0.3"
                            class="w-full h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                        <p class="text-xs text-red-500 mt-2 hidden bg-red-50 p-1 rounded border border-red-100"
                            id="error-msg">StdDev too high for this Mean!</p>
                    </div>
                </div>

                <!-- Data Controls -->
                <div class="bg-emerald-50 p-5 rounded-lg border border-emerald-100 h-full">
                    <h4
                        class="text-xs font-bold text-emerald-900 uppercase tracking-wide mb-4 border-b border-emerald-200 pb-2">
                        Survey Data (Part B)</h4>

                    <div class="mb-6">
                        <label class="flex justify-between text-sm font-medium text-slate-600 mb-2">
                            <span>Sample Size ($n$)</span>
                            <span id="val-n" class="font-mono text-emerald-600 font-bold">1000</span>
                        </label>
                        <input type="range" id="input-n" min="10" max="2000" step="10" value="1000"
                            class="w-full h-2 bg-emerald-200 rounded-lg appearance-none cursor-pointer accent-emerald-600">
                    </div>

                    <div>
                        <label class="flex justify-between text-sm font-medium text-slate-600 mb-2">
                            <span>Sample Support %</span>
                            <span id="val-p" class="font-mono text-emerald-600 font-bold">65%</span>
                        </label>
                        <input type="range" id="input-p" min="0" max="100" step="1" value="65"
                            class="w-full h-2 bg-emerald-200 rounded-lg appearance-none cursor-pointer accent-emerald-600">
                    </div>
                </div>
            </div>

            <!-- Graph (Below Controls) -->
            <div class="w-full bg-slate-50 rounded-lg border border-slate-200 p-2">
                <div id="plotDiv" class="w-full h-[450px]"></div>
            </div>
        </section>

    </main>

    <footer class="max-w-5xl mx-auto p-6 text-center text-slate-400 text-sm mt-12 pb-12">
        Generated for Bayesian Analysis
    </footer>

    <script>
        // --- Math Helpers ---

        // Log Gamma approximation (Lanczos) for calculating Beta PDF
        function logGamma(z) {
            const c = [
                0.99999999999980993, 676.5203681218851, -1259.1392167224028,
                771.32342877765313, -176.61502916214059, 12.507343278686905,
                -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7
            ];
            if (z < 0.5) return Math.log(Math.PI / Math.sin(Math.PI * z)) - logGamma(1 - z);
            z -= 1;
            let x = c[0];
            for (let i = 1; i < c.length; i++) x += c[i] / (z + i);
            const t = z + c.length - 0.5;
            return 0.5 * Math.log(2 * Math.PI) + (z + 0.5) * Math.log(t) - t + Math.log(x);
        }

        // Beta Probability Density Function
        function betaPDF(x, alpha, beta) {
            if (x <= 0 || x >= 1) return 0;
            const lnBetaFunc = logGamma(alpha) + logGamma(beta) - logGamma(alpha + beta);
            const lnVal = (alpha - 1) * Math.log(x) + (beta - 1) * Math.log(1 - x) - lnBetaFunc;
            return Math.exp(lnVal);
        }

        // --- Logic ---

        const inputs = {
            mu: document.getElementById('input-mu'),
            sigma: document.getElementById('input-sigma'),
            n: document.getElementById('input-n'),
            p: document.getElementById('input-p')
        };

        const labels = {
            mu: document.getElementById('val-mu'),
            sigma: document.getElementById('val-sigma'),
            n: document.getElementById('val-n'),
            p: document.getElementById('val-p')
        };

        const textOut = {
            alphaPrior: document.getElementById('text-alpha-prior'),
            betaPrior: document.getElementById('text-beta-prior'),
            alphaPost: document.getElementById('text-alpha-post'),
            betaPost: document.getElementById('text-beta-post'),
            meanPost: document.getElementById('text-mean-post'),
            error: document.getElementById('error-msg')
        };

        function update() {
            // 1. Get Values
            let mu = parseFloat(inputs.mu.value);
            let sigma = parseFloat(inputs.sigma.value);
            let n = parseInt(inputs.n.value);
            let p = parseInt(inputs.p.value) / 100;

            // 2. Validate Sigma (Variance < mu(1-mu))
            const maxVar = mu * (1 - mu);
            const maxSigma = Math.sqrt(maxVar) - 0.01; // buffer

            if (sigma > maxSigma) {
                sigma = maxSigma;
                textOut.error.classList.remove('hidden');
                textOut.error.textContent = `Max StdDev for mean ${mu} is ${maxSigma.toFixed(2)}`;
            } else {
                textOut.error.classList.add('hidden');
            }

            // Update Labels
            labels.mu.textContent = mu.toFixed(2);
            labels.sigma.textContent = sigma.toFixed(2);
            labels.n.textContent = n;
            labels.p.textContent = (p * 100).toFixed(0) + '%';

            // 3. Calculate Prior Parameters (Part A)
            const variance = sigma * sigma;
            const nu = ((mu * (1 - mu)) / variance) - 1;

            const alphaPrior = mu * nu;
            const betaPrior = (1 - mu) * nu;

            // 4. Calculate Posterior Parameters (Part B)
            const successes = Math.round(n * p);
            const failures = n - successes;

            const alphaPost = alphaPrior + successes;
            const betaPost = betaPrior + failures;

            const meanPost = alphaPost / (alphaPost + betaPost);
            const varPost = (alphaPost * betaPost) / (Math.pow(alphaPost + betaPost, 2) * (alphaPost + betaPost + 1));

            // 5. Update Text Output
            textOut.alphaPrior.textContent = `α ≈ ${alphaPrior.toFixed(2)}`;
            textOut.betaPrior.textContent = `β ≈ ${betaPrior.toFixed(2)}`;
            textOut.alphaPost.textContent = `α_post = ${alphaPost.toFixed(1)}`;
            textOut.betaPost.textContent = `β_post = ${betaPost.toFixed(1)}`;
            textOut.meanPost.textContent = `Mean ≈ ${meanPost.toFixed(4)} (Var: ${varPost.toFixed(5)})`;

            // 6. Plotting
            const x = [];
            const yPrior = [];
            const yPost = [];

            // Generate points
            for (let i = 1; i < 500; i++) {
                const val = i / 500;
                x.push(val);
                yPrior.push(betaPDF(val, alphaPrior, betaPrior));
                yPost.push(betaPDF(val, alphaPost, betaPost));
            }

            // Data Objects
            const tracePrior = {
                x: x,
                y: yPrior,
                type: 'scatter',
                mode: 'lines',
                name: 'Prior (Belief)',
                line: { color: '#6366f1', width: 2, dash: 'dash' },
                fill: 'tozeroy'
            };

            const tracePost = {
                x: x,
                y: yPost,
                type: 'scatter',
                mode: 'lines',
                name: 'Posterior (Result)',
                line: { color: '#10b981', width: 3 },
                fill: 'tozeroy'
            };

            // Main Combined Plot
            const layoutMain = {
                title: 'Prior vs Posterior Density',
                autosize: true,
                margin: { t: 40, r: 20, l: 20, b: 20 },
                xaxis: { title: 'Theta (Proportion)', range: [0, 1] },
                yaxis: { title: 'Density', showticklabels: false },
                showlegend: true,
                legend: { x: 0.5, y: 1.0, xanchor: 'center', orientation: 'h' },
                hovermode: 'x unified',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            const config = { responsive: true, displayModeBar: false };

            Plotly.react('plotDiv', [tracePrior, tracePost], layoutMain, config);

            // New: Prior Only Plot
            const layoutPrior = {
                margin: { t: 20, r: 20, l: 40, b: 40 },
                xaxis: { title: 'Theta', range: [0, 1] },
                yaxis: { title: 'Density' },
                showlegend: false
            };
            Plotly.react('plotPriorOnly', [tracePrior], layoutPrior, config);

            // New: Posterior Only Plot
            const layoutPost = {
                margin: { t: 20, r: 20, l: 40, b: 40 },
                xaxis: { title: 'Theta', range: [0, 1] },
                yaxis: { title: 'Density' },
                showlegend: false
            };
            Plotly.react('plotPosteriorOnly', [tracePost], layoutPost, config);

            // Re-render math safely
            if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                window.MathJax.typesetPromise();
            }
        }

        // Listeners
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', update);
        });

        // Init
        update();

    </script>
</body>

</html>